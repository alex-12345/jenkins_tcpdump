Отчет по Т1 ПЗ 1\
Винников Алексей\
Задание 1\
Вариант 1

###  1. Описать порядок сборки отладочной и релизной версий (получение исходного кода, установка зависимостей для сборки ОО, команды сборки ОО отладочной и релизной версий, содержимое docker-файла). ###

Содержимое Dockerfile везде одинаковое это базовый образ aflplusplus/aflplusplus:latest с дополнительно установленной библиотекой libpcap

Полное содержимое можно посмотреть в [Dockerfile](https://github.com/alex-12345/jenkins_tcpdump/blob/main/Dockerfile) 

Релизная версия собирается следующими командами:
```Bash
CFLAGS="-O3" \ # Линейка оптимизации 3 уровня для си кода
CXXFLAGS="-O3" \ # Линейка оптимизации 3 уровня для с++ кода
./configure
make -j$(nproc)
```

Отладочная версия собирается следующими командами:
```Bash
CFLAGS="-O0 -g3" \ # Линейка оптимизации 0 уровня и 3 уровень собираемой отладочной информации для си кода
CXXFLAGS="-O0 -g3" \ # Линейка оптимизации 0 уровня и 3 уровень собираемой отладочной информации для с++ кода
./configure 
make -j$(nproc)
```

Релизная и отладочная версия собирается поочереди сразу же после фазы выкачки исходного кода:

![Отладочная и релизная сборка](/images/build_debug_rel.png)

Перед каждой сборкой производится очистка рабочего пространства следующим образом, это справедливо и для всех пунктов ниже

```Bash
make distclean
git checkout tcpdump-4.5.0 -f
git clean -fd
```

### 2. Описать порядок сборки сборки ОО с датчиками ошибок (получение исходного кода, установка зависимостей для сборки ОО, команды сборки ОО с датчиками ошибок, содержимое docker-файла). ###

Содержимое докерфайла аналогичное предыщему пункту (см [Dockerfile](https://github.com/alex-12345/jenkins_tcpdump/blob/main/Dockerfile)). Также перед сборкой происходит отчистка описанная выше

Сама сборка происходит следующим образом
```Bash
CFLAGS="-O0 -g3" \ # Линейка оптимизации 0 уровня и 3 уровень собираемой отладочной информации для си кода
CXXFLAGS="-O0 -g3" \ # Линейка оптимизации 0 уровня и 3 уровень собираемой отладочной информации для с++ кода
CC=afl-cc CXX=afl-c++ ./configure # Включем фаззер alf
AFL_USE_ASAN=1 AFL_USE_UBSAN=1 make -j$(nproc)
```


Сборка с датчиками ошибок идет в конвеере сразу же после сборки отладочной версии

![Сборка с датчиками](/images/build_sanit.png)

### 3. Описать ключевые особенности подготовленного стенда, описать внесенные в код ПО и скрипты сборки изменения (скриншоты, патчи). ###
Подготовленный стенд представляет собой докер-контейней основннаый на aflplusplus/aflplusplus:latest (см [Dockerfile](https://github.com/alex-12345/jenkins_tcpdump/blob/main/Dockerfile)) в котором Jenkins в конвеере задданом в [Jenkinsfile](https://github.com/alex-12345/jenkins_tcpdump/blob/main/Jenkinsfile) поочередно выполняет сборки. Все необходимые для сборки зависимости есть в исходном докер-образе, за исключением библиотеки libpcap которая устанавляется дополнительно. Исходный код собирается успешно без каких либо модификации. Часть тестов замущенных через `make check` падают см скриншот ниже

![Упавшие тесты](/images/test_failed.png)

Исходя из лога проблема полностью соответсвует [ данному issue](https://github.com/the-tcpdump-group/tcpdump/issues/381) однако решение в виде сборки с libssl и фиксом сборки в форке (см [коммит](https://github.com/the-tcpdump-group/tcpdump/commit/4980ad82871f50c628519982dfd7e18efed13b72)) никакого успеха не принесли. Так что замер покрытия выполняется несмотря на упавшие тесты

### 4. Описать порядок установки и настройки CI/CD системы Jenkins. Описать порядок добавления заданий на сборку различных версий ОО. ###

Система сборки jenkins установлена на виртуальную машину с ubuntu.

Установлена по инструкции с оффициального [сайта](https://www.jenkins.io/doc/book/installing/linux/#debianubuntu). Также на ввиртуальную машину установлен docker.

В jenkins установлены рекомендуемые плагины а также дополнительно установлены плагины `Docker API Plugin` и `Docker Pipeline`

Пайплаин создан как Pipline script from SCM

![пайплаин](/images/jenkins_pipe.png)

Все варианты сборки запускаются в одном конвеере по порядку определеном в [Jenkinsfile](https://github.com/alex-12345/jenkins_tcpdump/blob/main/Jenkinsfile)

После выполнения пайплайна получаем артефакты сборки

![артефакты](/images/artifacts.png)

coverage_report.tar.xz содержит html страницу с отчетом по покрытию тестами скриншот приведен ниже

![покрытие](/images/cov.png)